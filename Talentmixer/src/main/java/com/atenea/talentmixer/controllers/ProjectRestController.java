package com.atenea.talentmixer.controllers;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.dao.DataAccessException;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.servlet.support.ServletUriComponentsBuilder;

import com.atenea.talentmixer.models.dto.ProjectDto;
import com.atenea.talentmixer.models.entities.Project;
import com.atenea.talentmixer.models.services.IprojectService;

@CrossOrigin(origins= {"*"})
@RestController
@RequestMapping("/projects")
public class ProjectRestController {
	
	@Autowired
	private IprojectService projectService;
	
	@GetMapping("/dto")
	public List<ProjectDto> indexDto(){
		List<ProjectDto> listaDto = new ArrayList<>();
		projectService.findAll().forEach(project->{
			listaDto.add(new ProjectDto(project.getId(),project.getTitle(),project.getSummary(),project.getDescription(),project.getCreatedAt(),project.getImage()));
		});		
		return listaDto;
	}
	
	@GetMapping("")
	public ResponseEntity<?> index(){
		
		List<Project> respuesta = new ArrayList<Project>();
		Map<String,Object> response = new HashMap<>();
		
		try {
			respuesta = projectService.findAll()
					.stream()
		            .map(p -> {
		                Project project = new Project(p);
		                if(project.getImage()!=null)
		                	project.setImage(ServletUriComponentsBuilder.fromCurrentContextPath().build().toUriString() + "/" + project.getImage());
		                return project;
		            })
		            .collect(Collectors.toList());
		} catch (DataAccessException e) {  
			response.put("mensaje", "Error al conectar con la base de datos");
			response.put("error", e.getMessage().concat(":")
					.concat(e.getMostSpecificCause().getMessage()));
			return new ResponseEntity<Map<String,Object>>(response,HttpStatus.INTERNAL_SERVER_ERROR);
		}
		
		return new ResponseEntity<List<Project>>(respuesta,HttpStatus.OK);
	}
	
	@GetMapping("/{id}")  
	public ResponseEntity<?> show(@PathVariable int id){
		
		Project project = null;
		Map<String,Object> response = new HashMap<>();
		try {
			project = projectService.findById(id);
		} catch (DataAccessException e) {  
			response.put("mensaje", "Error al conectar con la base de datos");
			response.put("error", e.getMessage().concat(":")
					.concat(e.getMostSpecificCause().getMessage()));
			return new ResponseEntity<Map<String,Object>>(response,HttpStatus.INTERNAL_SERVER_ERROR);
		}
		if(project==null) {
			response.put("mensaje", "El proyecto con ID: ".concat(id+"").concat(" no existe"));
			return new ResponseEntity<Map<String,Object>>(response,HttpStatus.NOT_FOUND);
		}
        if(project.getImage()!=null) 
        	project.setImage(ServletUriComponentsBuilder.fromCurrentContextPath().build().toUriString() + "/" + project.getImage());

		return new ResponseEntity<Project>(project,HttpStatus.OK);		
	}
	

	@DeleteMapping("/{id}")
	public ResponseEntity<?> delete(@PathVariable int id){
		Project project = null;
		Map<String,Object> response = new HashMap<>();
		try {
			project = projectService.findById(id);
			projectService.delete(id);
		} catch (DataAccessException e) {  
			response.put("mensaje", "Error al eliminar el id");
			response.put("error", e.getMessage().concat(":")
					.concat(e.getMostSpecificCause().getMessage()));
			return new ResponseEntity<Map<String,Object>>(response,HttpStatus.NOT_FOUND);
		}
		if(project==null) {  
			response.put("mensaje", "El proyecto con ID: ".concat(id+"").concat(" no existe"));
			return new ResponseEntity<Map<String,Object>>(response,HttpStatus.NOT_FOUND);
		}
		response.put("mensaje", "El proyecto se ha borrado correctamente");
		return new ResponseEntity<Map<String,Object>>(response,HttpStatus.OK);
	}
	
	@PostMapping("")
	public ResponseEntity<?> create(@RequestBody Project project){
		
		Project newProject = null;
		Map<String,Object> response = new HashMap<>();
					
		try {
			newProject = projectService.save(project);
			if(project.getImage()!=null)
				newProject.setImage(ServletUriComponentsBuilder.fromCurrentContextPath().build().toUriString() + "/" + newProject.getImage());
				
		} catch (DataAccessException e) { 
			response.put("mensaje", "Error al conectar con la base de datos");
			response.put("error", e.getMessage().concat(":")
					.concat(e.getMostSpecificCause().getMessage()));
			return new ResponseEntity<Map<String,Object>>(response,HttpStatus.INTERNAL_SERVER_ERROR);
		}
		
		response.put("mensaje", "El proyecto se ha insertado correctamente");
		response.put("project", newProject);
		return new ResponseEntity<Map<String,Object>>(response,HttpStatus.CREATED);
	}
	
	
	@PutMapping("/{id}")
	public ResponseEntity<?> update(@RequestBody Project project, @PathVariable int id){
		
		Project currentProject = null;
		Project updatedProject = null;
		Map<String,Object> response = new HashMap<>();
			
		try {
			currentProject = projectService.findById(id); 
		} catch (DataAccessException e) {  
			response.put("mensaje", "Error al conectar con la base de datos");
			response.put("error", e.getMessage().concat(":")
					.concat(e.getMostSpecificCause().getMessage()));
			return new ResponseEntity<Map<String,Object>>(response,HttpStatus.INTERNAL_SERVER_ERROR);
		}
		
		if(currentProject==null) {
			response.put("mensaje", "El proyecto con ID: ".concat(id+"").concat(" no existe en la base de datos"));
			return new ResponseEntity<Map<String,Object>>(response,HttpStatus.NOT_FOUND);
		}
		try {
			currentProject.setTitle(project.getTitle());
			currentProject.setSummary(project.getSummary());
			currentProject.setDescription(project.getDescription());
			currentProject.setCreatedAt(project.getCreatedAt());
			if(project.getImage() != null)
				currentProject.setImage(project.getImage());
			updatedProject = projectService.save(currentProject);
			if(project.getImage() != null)
				updatedProject.setImage(ServletUriComponentsBuilder.fromCurrentContextPath().build().toUriString() + "/" + updatedProject.getImage());
			if(project.getImage() == null) project.setImage("data:image/png;base64,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AQO3QO+a21trH6cPQIa6Wr4BDg6BsSJlr3u8O9DZ279nWv39ANFvcs1yXwMtAAANdmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNC40LjAtRXhpdjIiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iCiAgICB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIgogICAgeG1sbnM6R0lNUD0iaHR0cDovL3d3dy5naW1wLm9yZy94bXAvIgogICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgIHhtcE1NOkRvY3VtZW50SUQ9ImdpbXA6ZG9jaWQ6Z2ltcDpjMzlkNDJlYi02MDRiLTQyODctYmQ1My01ODMwNGQwYzE3YTQiCiAgIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NjQwYTgxMDUtYWIwMy00NWRhLThhM2MtMDhlOTI3YzcwNTA2IgogICB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6NzRiM2ZiN2EtZTM2OS00MTRkLWIzNGEtMjYyNjRkOWNmOGRhIgogICBHSU1QOkFQST0iMi4wIgogICBHSU1QOlBsYXRmb3JtPSJXaW5kb3dzIgogICBHSU1QOlRpbWVTdGFtcD0iMTY3OTkwNzgwMDQzMTEyOSIKICAgR0lNUDpWZXJzaW9uPSIyLjEwLjMyIgogICBkYzpGb3JtYXQ9ImltYWdlL3BuZyIKICAgdGlmZjpPcmllbnRhdGlvbj0iMSIKICAgeG1wOkNyZWF0b3JUb29sPSJHSU1QIDIuMTAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjM6MDM6MjdUMTE6MDM6MTgrMDI6MDAiCiAgIHhtcDpNb2RpZnlEYXRlPSIyMDIzOjAzOjI3VDExOjAzOjE4KzAyOjAwIj4KICAgPHhtcE1NOkhpc3Rvcnk+CiAgICA8cmRmOlNlcT4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiCiAgICAgIHN0RXZ0OmNoYW5nZWQ9Ii8iCiAgICAgIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ZTg2NGYwMTEtOTVhYS00NmIxLWI3OWYtZmEzODY4ZDcxNDM3IgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJHaW1wIDIuMTAgKFdpbmRvd3MpIgogICAgICBzdEV2dDp3aGVuPSIyMDIzLTAzLTI3VDExOjAzOjIwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/PmE7eNoAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfnAxsJAxQ5C5flAAAMbElEQVR42u1ce2wUxx3+zcw+zr6z8fl5xi9huMO52GeffYdx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");
		} catch (DataAccessException e) { 
			response.put("mensaje", "Error al conectar con la base de datos");
			response.put("error", e.getMessage().concat(":")
					.concat(e.getMostSpecificCause().getMessage()));
			return new ResponseEntity<Map<String,Object>>(response,HttpStatus.INTERNAL_SERVER_ERROR);
		}
		
		response.put("mensaje", "El proyecto se ha modificado correctamente");
		response.put("project", updatedProject);
		return new ResponseEntity<Map<String,Object>>(response,HttpStatus.CREATED);

	}

	
	

}
